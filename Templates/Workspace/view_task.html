
{% include "head.html" %}
{% load static %}
{% load home_extras %}
<!--<link rel="stylesheet" type="text/css" href="{% static "qb_style.css" %}">-->
<style>
    .test
    {
        color:green;

    }
    .overlay{
        height:100%;
        position:fixed;
        width:100%;
        z-index:2000;
        left:0px;
        top:0px;
        background-color: rgba(50,50,50,0.5);
    }

    .select2-selection--single{
        height:100%!important;
    }

    .loader {
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
        position:fixed;
        top:calc(50% - 60px);
        left:calc(50% - 60px);
        z-index:2001;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .jkl{
        top:100px;
    }
</style>
<body>
        {% include "sidebarlinks.html" %}
        <div class="main-content" id="panel">
            <!-- Navbar -->
            {% include "navbar.html" %}
            <div class="header bg-primary pb-6">
                <div class="container-fluid">
                    <div class="header-body">
                        <div class="row align-items-center py-4">
                            <div class="col-lg-6 col-7">
                                <h6 class="h2 text-white d-inline-block mb-0">Default</h6>
                                <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                                    <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                                        <li class="breadcrumb-item"><a href="#"><i class="fas fa-home"></i></a></li>
                                        <li class="breadcrumb-item"><a href="#">Report Management</a></li>
                                        <li class="breadcrumb-item active" aria-current="page">Viewer</li>
                                    </ol>
                                </nav>
                            </div>
                            <!--                            <div class="col-lg-6 col-5 text-right">-->
                            <!--                                <a href="#" class="btn btn-sm btn-neutral">New</a>-->
                            <!--                                <a href="#" class="btn btn-sm btn-neutral">Filters</a>-->
                            <!--                            </div>-->
                        </div>
                        <!-- Card stats -->
                        <section id="summary" class="shadow p-3 mb-5 rounded-lg text-white" >
                            <div class="overlay d-none">
                                <div class="loader d-none">

                                </div>

                            </div>

                            <h3 class="text-center text-white" > Summary </h3>
                            <div class="table-responsive">
                                <table class="table align-items-center table-flush">
                                <thead>
                                <tr class="text-white">
                                    <th class="text-center">#</th>
                                    <th>Client Name</th>
                                    <th>Report Level</th>
                                    <th>Initiated by</th>
                                    <th>Report Type</th>
                                    <th>Report Status</th>
                                    {% if perms.ReportManagement.add_report and  request.user|has_group:"Accountant"%}
                                        <th>Task Status</th>
                                    {% endif %}
                                    <th>Generated At</th>
                                    {% if perms.ReportManagement.add_report and  request.user|has_group:"Accountant"%}
                                    <th class="text-right">Actions</th>
                                    {% endif %}
                                    <th>Downloads</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr class="text-white">
                                    <td class="text-center">1</td>
                                    <td>[[report.customer | entityName]]  </td>
                                    <td>
                                                    <span v-if="reportLevelList[reportTypeList.indexOf(report.report_type_id)] =='customer'"> NA </span>
                                                    <span v-if="reportLevelList[reportTypeList.indexOf(report.report_type_id)] =='legalentity'"> [[report.legalentity["name"] ]]</span>
                                                    <span v-if="reportLevelList[reportTypeList.indexOf(report.report_type_id)] =='outlet'"> [[report.outlet["name"] ]]</span>
                                                    <span v-if="reportLevelList[reportTypeList.indexOf(report.report_type_id)] =='brand'"> [[report.brand["name"] ]]</span>
                                    </td>
                                    <td>[[ report.owner ]]</td>
                                    <td>[[ report.report_type ]]</td>
                                    <td>[[ report.status ]]</td>
                                    {% if perms.ReportManagement.add_report and  request.user|has_group:"Accountant"%}
                                        <td>[[ task_status.status ]]</td>
                                    {% endif %}
                                    <td>[[ report.month ]]/[[ report.year ]] </td>


                                    {% if perms.ReportManagement.add_report and request.user|has_group:"Accountant" %}
                                    <td class="td-actions text-right" v-if="report.status =='Review' || report.status=='Initiated'">
                                        <a href="#" @click="processtask(report.report_type,report.id)" class="actiontask btn btn-success btn-sm btn-icon">
                                            <i class="ni ni-button-play"></i>
                                        </a>
{#                                        <a href="#" @click="processjsontask(report.report_type,report.id)" class="actiontask btn btn-success btn-sm btn-icon">#}
{#                                            <i class="ni ni-button-play"></i>#}
{#                                        </a>#}
                                    </td>
                                    {% endif %}
                                    <td>
                                        <button type="button" rel="tooltip" report.status=='Published'  class="btn btn-success btn-sm btn-icon">
                                                        <a style="color:white" :href="'/reports/get/file/'+(report.id)+'/0/excel/'" target="_blank"><i class="fa fa-file-excel-o"></i></a>
                                                    </button>
                                                    <button type="button" rel="tooltip" report.status=='Published' class="btn btn-danger btn-sm btn-icon">
                                                        <a style="color:white" :href="'/reports/get/file/'+(report.id)+'/0/pdf/'" target="_blank"><i class="fa fa-file-pdf-o"></i></a>
                                                    </button>
                                                    <button type="button" v-if="report.report_type=='Closing Stock' && report.status=='Published'" rel="tooltip" class="btn btn-info btn-sm btn-icon">
                                                        <a :href="'/reports/get/file/'+(report.id)+'/1/excel'" target="_blank"><i class="fa fa-file-excel-o"></i></a>
                                                    </button>
                                                    <button type="button" v-if="report.report_type=='Swiggy Dump Level Reconciliation' && report.status=='Published'" rel="tooltip" class="btn btn-info btn-sm btn-icon">
                                                        <a :href="'/reports/get/file/'+(report.id)+'/1/excel'" target="_blank"><i class="fa fa-file-excel-o"></i></a>
                                                    </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            </div>
                            <div class="row bg-white" v-if="task_status.status == 'FAILURE'">
                                <div class="col-12">
                                    <div class="row">
                                        <div class="col-4">
                                            <h4> Task ID </h4>
                                        </div>
                                        <div class="col-8">
                                            <h6 class="text-danger"> [[ task_id ]] </h6>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-4">
                                            <h4> Error </h4>
                                        </div>
                                        <div class="col-8">
                                            <h6 class="text-danger"> [[ task_status.traceback ]] </h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% if perms.insights.add_report %}
<!--                            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">-->
<!--                                <div class="modal-dialog" role="document">-->
<!--                                    <div class="modal-content">-->
<!--                                        <div class="modal-header">-->
<!--                                            <h5 class="modal-title" id="exampleModalLabel">Report Generation</h5>-->
<!--                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">-->
<!--                                                <span aria-hidden="true">&times;</span>-->
<!--                                            </button>-->
<!--                                        </div>-->
<!--                                        <div class="modal-body">-->
<!--                                            <form method="post" enctype="multipart/form-data" id="P_Lform">-->
<!--                                                <div class="card card-login card-plain">-->
<!--                                                    {% csrf_token %}-->
<!--                                                    <div class="card-header">-->
<!--                                                        <h5>Profit and Loss Statement</h5>-->
<!--                                                    </div>-->
<!--                                                    <div class="card-body">-->

<!--                                                        <label>-->
<!--                                                            From QB Input File-->
<!--                                                            <input type="file" name="pl_qb_in_file" id="id_pl_qb_in_file" class="form-control-file" required>-->
<!--                                                        </label>-->

<!--                                                        <label>-->
<!--                                                            Category list-->
<!--                                                            <input type="file" name="pl_cat_in_file" id="id_pl_cat_in_file" class="form-control-file" required>-->
<!--                                                        </label>-->

<!--                                                        <input type="text" name="report_type" id="id_report_type" value="P_L" hidden class="form-control-file">-->
<!--                                                    </div>-->

<!--                                                    <div class="card-footer ">-->
<!--                                                        <input id="PLSubmit" class="reportsubmit btn btn-primary btn-round btn-lg btn-block mb-3" type="button" value="Generate P-L Report">-->
<!--                                                        <input type="hidden" name="next" value="{{ next }}">-->
<!--                                                    </div>-->
<!--                                                </div>-->
<!--                                            </form>-->
<!--                                        </div>-->
<!--                                        <div class="modal-footer">-->
<!--                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>-->
<!--                                            <button type="button" class="btn btn-primary">Save changes</button>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
                            {% endif %}
                        </section>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-4 pt-5">
                        <div class="card">
                            <div class="card-header bg-transparent">
                                <h3 class="mb-0"> Report Status Timeline</h3>
                            </div>
                            <div class="card-body" style="height: 120vh;overflow-y: scroll;">
                                <div class="timeline timeline-one-side" data-timeline-content="axis" data-timeline-axis-style="dashed">
                                    <div class="timeline-block" v-for="act in activities">
                                        <span class="timeline-step badge-success" v-if="act.eventtype == 'lifecycle' || act.eventtype == 'Lifecycle'">
                                            <i class="ni ni-bell-55" ></i>
                                        </span>

                                        <span class="timeline-step badge-warning" v-if="act.eventtype == 'anomaly' || act.eventtype == 'Anomaly'">
                                            <i class="ni ni-html5" ></i>
                                        </span>

                                        <span class="timeline-step badge-warning" v-if="act.eventtype == 'comment' || act.eventtype == 'Comment'">
                                            <i class="ni ni-html5" ></i>
                                        </span>

                                        <div class="timeline-content">
                                            <small class="text-muted font-weight-bold">[[ act.date ]]</small>
                                            <h5 class=" mt-3 mb-0"> [[ act.eventtype ]]</h5>
                                            <p class=" text-sm mt-1 mb-0" v-if="act.eventtype == 'lifecycle' || act.eventtype == 'Lifecycle'">[[ act.message ]]</p>
                                            <p class=" text-sm mt-1 mb-0" v-if="act.eventtype == 'anomaly' || act.eventtype == 'Anomaly'">[[ act.eventvalue.anomaly_description ]]</p>
                                            <p class=" text-sm mt-1 mb-0" v-if="act.eventtype == 'comment' || act.eventtype == 'Comment'">[[ act.eventvalue.comment_description ]]</p>
                                            <p class=" text-sm mt-1 mb-0 text-warning" v-if="act.eventtype == 'lifecycle' || act.eventtype == 'Lifecycle'">[[ act.modifiername ]]</p>
                                            <p class=" text-sm mt-1 mb-0 text-warning" v-if="act.eventtype == 'anomaly' || act.eventtype == 'Anomaly'">[[ act.eventvalue.anomaly_author ]]</p>
                                            <p class=" text-sm mt-1 mb-0 text-warning" v-if="act.eventtype == 'comment' || act.eventtype == 'Comment'">[[ act.eventvalue.comment_author ]]</p>
                                            <div class="mt-3">
                                                <span class="badge badge-pill badge-success">[[act.status]]</span>
                                                <span class="badge badge-pill badge-success">[[act.month]]</span>
                                                <span class="badge badge-pill badge-success">creative</span>
                                            </div>
                                        </div>
                                    </div>
<!--                                    <div class="timeline-block">-->
<!--                                      <span class="timeline-step badge-danger">-->
<!--                                        <i class="ni ni-html5"></i>-->
<!--                                      </span>-->
<!--                                        <div class="timeline-content">-->
<!--                                            <small class="text-muted font-weight-bold">10:30 AM</small>-->
<!--                                            <h5 class=" mt-3 mb-0">Product issue</h5>-->
<!--                                            <p class=" text-sm mt-1 mb-0">Nullam id dolor id nibh ultricies vehicula ut id elit. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p>-->
<!--                                            <div class="mt-3">-->
<!--                                                <span class="badge badge-pill badge-danger">design</span>-->
<!--                                                <span class="badge badge-pill badge-danger">system</span>-->
<!--                                                <span class="badge badge-pill badge-danger">creative</span>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                    <div class="timeline-block">-->
<!--                                      <span class="timeline-step badge-info">-->
<!--                                        <i class="ni ni-like-2"></i>-->
<!--                                      </span>-->
<!--                                        <div class="timeline-content">-->
<!--                                            <small class="text-muted font-weight-bold">10:30 AM</small>-->
<!--                                            <h5 class=" mt-3 mb-0">New likes</h5>-->
<!--                                            <p class=" text-sm mt-1 mb-0">Nullam id dolor id nibh ultricies vehicula ut id elit. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p>-->
<!--                                            <div class="mt-3">-->
<!--                                                <span class="badge badge-pill badge-info">design</span>-->
<!--                                                <span class="badge badge-pill badge-info">system</span>-->
<!--                                                <span class="badge badge-pill badge-info">creative</span>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                    <div class="timeline-block">-->
<!--                                      <span class="timeline-step badge-success">-->
<!--                                        <i class="ni ni-bell-55"></i>-->
<!--                                      </span>-->
<!--                                        <div class="timeline-content">-->
<!--                                            <small class="text-muted font-weight-bold">10:30 AM</small>-->
<!--                                            <h5 class=" mt-3 mb-0">New message</h5>-->
<!--                                            <p class=" text-sm mt-1 mb-0">Nullam id dolor id nibh ultricies vehicula ut id elit. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p>-->
<!--                                            <div class="mt-3">-->
<!--                                                <span class="badge badge-pill badge-success">design</span>-->
<!--                                                <span class="badge badge-pill badge-success">system</span>-->
<!--                                                <span class="badge badge-pill badge-success">creative</span>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                    <div class="timeline-block">-->
<!--                                      <span class="timeline-step badge-danger">-->
<!--                                        <i class="ni ni-html5"></i>-->
<!--                                      </span>-->
<!--                                        <div class="timeline-content">-->
<!--                                            <small class="text-muted font-weight-bold">10:30 AM</small>-->
<!--                                            <h5 class=" mt-3 mb-0">Product issue</h5>-->
<!--                                            <p class=" text-sm mt-1 mb-0">Nullam id dolor id nibh ultricies vehicula ut id elit. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p>-->
<!--                                            <div class="mt-3">-->
<!--                                                <span class="badge badge-pill badge-danger">design</span>-->
<!--                                                <span class="badge badge-pill badge-danger">system</span>-->
<!--                                                <span class="badge badge-pill badge-danger">creative</span>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <section id="reportviewer" class="shadow p-3 mb-5 rounded-lg" style="margin-top:50px;height:100vh;">
                            <h3 class="text-center" style="margin-bottom:10px!important;"> Report Viewer </h3>
                            <div id="pdfviewer" style="width:100%;height:calc(100vh - 70px); position:relative;">
                            </div>
                        </section>


                        <section id="comment" class="shadow p-3 mb-5 rounded-lg" style="margin-top:50px;">
                            <h3 class="text-center"> Insights </h3>
                            <div class="table-responsive">
                                <table class="table align-items-center table-flush">
                                    <thead>
                                    <tr>
                                        <th class="text-center">#</th>
                                        <th>Category</th>
                                        <th>Type</th>
                                        <th>Description</th>
                                        <th>Remarks</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr is="commentitem" v-for="(cl,index) in comments" :id="index+1" :comment_description="cl.comment_description" :comment_category="cl.comment_category" :comment_remarks="cl.comment_remarks" :comment_type="cl.comment_type" :comment_author="cl.comment_author" :comment_datetime="cl.comment_datetime" :comment_delete="index" :comment_modify="index" :button_visible="proceed"></tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="row">
                                <div class="col-md-3">
                                    <button class="btn btn-success" v-if="proceed || revert" @click="opencheckpointmodal">Add Insight</button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-warning" v-if="proceed || revert" @click="regenerate_report">Regenerate Report</button>
                                </div>
                                <div class="modal fade" id="commentModal" v-if="report.report_type == 'Profit Statement'" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="commentModalLabel">Add Insight</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="card card-login card-plain">
                                                    <div class="card-body">
                                                        <form>
                                                            <div class="form-group">
                                                                <label>
                                                                    Category
                                                                </label>
                                                                <select class="form-control" id="insight_category"></select>
                                                            </div>

                                                            <div class="form-group">
                                                                <label>
                                                                    Type
                                                                </label>
                                                                <select id="insight_type"></select>

                                                            </div>
                                                            <div class="form-group">
                                                                <label >
                                                                    Add Description
                                                                </label>
                                                                <select id="insight_notes" v-model="notes"></select>
                                                            </div>

                                                            <div class="form-group">
                                                                <label >
                                                                    Modify Notes
                                                                </label>
                                                                <textarea class="form-control" v-model="notes" rows="3"></textarea>
                                                            </div>

                                                            <div class="form-group">
                                                                <label>
                                                                    Add Remarks
                                                                </label>
                                                                <textarea class="form-control" rows="3" id="remarks"></textarea>
                                                            </div>
                                                        </form>

                                                    </div>

                                                    <div cla.oss="card-footer ">

                                                    </div>
                                                </div>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                <button type="button" @click="addcheckpoint" class="btn btn-primary">Save changes</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" id="commentModal" v-if="report.report_type != 'Profit Statement'" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="commentModalLabel">Add Insight</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="card card-login card-plain">
                                                    <div class="card-body">
                                                        <form>

                                                            <div class="form-group">
                                                                <label>
                                                                    Add Remarks
                                                                </label>
                                                                <textarea class="form-control" rows="3" id="remarks"></textarea>
                                                            </div>
                                                        </form>

                                                    </div>

                                                    <div cla.oss="card-footer ">

                                                    </div>
                                                </div>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                <button type="button" @click="addcheckpoint" class="btn btn-primary">Save changes</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" id="EditcommentModal" v-if="report.report_type == 'Profit Statement' && comments.length>0" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="EditcommentModalLabel">Modify Insight</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">

                                                <div class="card card-login card-plain">
                                                    <div class="card-body">
                                                        <form>
                                                            <div class="form-group">
                                                                <label>
                                                                    Modify Category
                                                                </label>
                                                                <select class="form-control" id="edit_insight_category"></select>
                                                            </div>

                                                            <div class="form-group">
                                                                <label>
                                                                    Modify Type
                                                                </label>
                                                                <select id="edit_insight_type" ></select>

                                                            </div>
                                                            <div class="form-group">
                                                                <label >
                                                                    Modify Description
                                                                </label>
                                                                <select id="edit_insight_notes" ></select>
                                                            </div>

                                                            <div class="form-group">
                                                                <label >
                                                                    Modify Notes
                                                                </label>
                                                                <textarea class="form-control" id="edit_insights_description" rows="3" v-model="comments[current_comment_index].comment_description"></textarea>
                                                            </div>

                                                            <div class="form-group">
                                                                <label>
                                                                    Modify Remarks
                                                                </label>
                                                                <textarea class="form-control" rows="3" id="edit_remarks" v-model="comments[current_comment_index].comment_remarks"></textarea>
                                                            </div>
                                                        </form>

                                                    </div>

                                                    <div class="card-footer ">

                                                    </div>
                                                </div>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                <button type="button" @click="modifycheckpoint" class="btn btn-primary">Save changes</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" id="EditcommentModal" v-if="report.report_type != 'Profit Statement' && comments.length>0" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="EditcommentModalLabel">Modify Insight</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">

                                                <div class="card card-login card-plain">
                                                    <div class="card-body">
                                                        <form>
                                                            <div class="form-group">
                                                                <label>
                                                                    Modify Remarks
                                                                </label>
                                                                <textarea class="form-control" rows="3" id="edit_remarks" v-model="comments[current_comment_index].comment_remarks"></textarea>
                                                            </div>
                                                        </form>

                                                    </div>

                                                    <div class="card-footer ">

                                                    </div>
                                                </div>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                <button type="button" @click="modifycheckpoint" class="btn btn-primary">Save changes</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </section>
                        <div class="accordion" id="accordionExample">
                            {% if not request.user|has_group:"Customer" %}
                            <div class="card" id="acc_checklist" class="shadow p-3 mb-5 rounded-lg" v-if="checklist_loaded ==true && checklists.length!=0 && report.status!='Initiated'" style="margin-top:50px;">
                                <div class="card-header bg-light" id="AccChecklistHeading" data-toggle="collapse" data-target="#collapseAccChecklist" aria-expanded="true" aria-controls="collapseOne">
                                    <h3 class="text-center"> Accountant Checklists </h3>
                                </div>
                                <div id="collapseAccChecklist" class="collapse" aria-labelledby="AccChecklistHeading" data-parent="#accordionExample">
                                    <div class="card-body" >
                                        <div class="container-fluid" v-if="'sales' in checklists.acc_checklist">
                                            <h4> Sales </h4>
                                            <table class="table table-responsive">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.acc_checklist.sales" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.acc_checklist.sales[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.acc_checklist.sales[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid" v-if="'purchases' in checklists.acc_checklist">
                                            <h4> Purchases </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4" style="white-space: unset;">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.acc_checklist.purchases"  class="d-flex">
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;">[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.acc_checklist.purchases[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.acc_checklist.purchases[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid" v-if="'expenses' in checklists.acc_checklist">
                                            <h4> Expenses </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.acc_checklist.expenses" class="d-flex"  >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.acc_checklist.expenses[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.acc_checklist.expenses[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid" v-if="'bank_transactions' in checklists.acc_checklist">
                                            <h4> Bank Transactions </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.acc_checklist.bank_transactions" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.acc_checklist.bank_transactions[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.acc_checklist.bank_transactions[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid" v-if="'statutory_duties' in checklists.acc_checklist">
                                            <h4> Statutory Duties </h4>
                                            <table class="table" >
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.acc_checklist.statutory_duties" class="d-flex"  >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.acc_checklist.statutory_duties[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.acc_checklist.statutory_duties[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid" v-if="'closing_stock' in checklists.acc_checklist">
                                            <h4> Closing Stock </h4>
                                            <table class="table align-items-center table-flush">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.acc_checklist.closing_stock" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.acc_checklist.closing_stock[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.acc_checklist.closing_stock[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid" v-if="'profit_statement' in checklists.acc_checklist">
                                            <h4> Profit Statement </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.acc_checklist.profit_statement" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;">[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.acc_checklist.profit_statement[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.acc_checklist.profit_statement[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        {% if request.user|has_group:"Accountant" %}
                                        <div class="row" v-if="report.status == 'Initiated' || report.status == 'Review'">
                                            <div class="col-md-6 col-6">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                            </div>
                                            <div class="col-md-6 col-6">
                                                <button type="button" @click="addchecklists" class="btn btn-primary">Save changes</button>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            {% if request.user|has_group:"TeamLead" is False %}
                            <div class="card d-none" id="tl_checklist" class="shadow p-3 mb-5 rounded-lg" v-if="checklist_loaded ==true && checklists.length!=0 " style="margin-top:50px;">
                                <div class="card-header bg-light" id="TLChecklistHeading" data-toggle="collapse" data-target="#collapseTLChecklist" aria-expanded="true" aria-controls="collapseOne">

                                    <h3 class="text-center"> Teamlead Checklists </h3>

                                </div>
                                <div id="collapseTLChecklist" class="collapse" aria-labelledby="TLChecklistHeading" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="container-fluid">
                                            <h4> Sales </h4>
                                            <table class="table table-responsive">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.sales" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.sales[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.sales[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Other Income </h4>
                                            <table class="table table-responsive">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.otherincome" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.otherincome[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.otherincome[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Purchases </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4" style="white-space: unset;">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.purchases"  class="d-flex">
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;">[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.purchases[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.purchases[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Cash Book </h4>
                                            <table class="table" >
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.cashbook" class="d-flex"  >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.cashbook[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.cashbook[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Expenses </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.expenses" class="d-flex"  >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.expenses[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.expenses[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Bank Transactions </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.bank_transactions" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.bank_transactions[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.bank_transactions[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Loans </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.loans" class="d-flex"  >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4"  style="white-space: unset;">[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.loans[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.loans[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Statutory Duties </h4>
                                            <table class="table" >
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.statutory_duties" class="d-flex"  >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.statutory_duties[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.statutory_duties[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Other Balance Sheet </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.other_balance_sheet" class="d-flex"  >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;">[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.other_balance_sheet[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.other_balance_sheet[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Closing Stock </h4>
                                            <table class="table align-items-center table-flush">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.closing_stock" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.closing_stock[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.closing_stock[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Partner's/Director's Transactions </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.partner_directors_transactions" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;">[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.partner_directors_transactions[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.partner_directors_transactions[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="container-fluid">
                                            <h4> Profit Statement </h4>
                                            <table class="table">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in checklists.tl_checklist.profit_statement" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;">[[cl.check]]</td>
                                                    <td class="col-2">
                                                        <select class="form-control" v-model="checklists.tl_checklist.profit_statement[index].input">
                                                            <option  value="False">False</option>
                                                            <option  value="True">True</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="checklists.tl_checklist.profit_statement[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        {% if request.user|has_group:"TeamLead" %}
                                        <div class="row" v-if="report.status=='TL'">
                                            <div class="col-md-6 col-6">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                            </div>
                                            <div class="col-md-6 col-6">
                                                <button type="button" @click="addchecklists" class="btn btn-primary">Save changes</button>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            {% if request.user|has_group:"QC" or request.user|has_group:"CRM"%}
                            <div class="card" id="qc_checklist" class="shadow p-3 mb-5 rounded-lg" v-if="checklist_loaded ==true && checklists.length!=0 " style="margin-top:50px;">
                                <div class="card-header bg-light" id="QCChecklistHeading" data-toggle="collapse" data-target="#collapseQCChecklist" aria-expanded="true" aria-controls="collapseOne">

                                    <h3 class="text-center"> QC Checklists </h3>

                                </div>
                                <div id="collapseQCChecklist" class="collapse" aria-labelledby="QCChecklistHeading" data-parent="#accordionExample">
                                    <div class="card-body" v-if="checklists.qc_checklist" >


                                        <div class="container-fluid" v-for="(comcl,index) in checklists.qc_checklist.commonChecklist">
                                            <h4> [[comcl.name]] </h4>
                                            <table class="table table-responsive">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in comcl.checklists" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2 pl-1 pr-1">
                                                        <select class="form-control" v-model="comcl.checklists[index].input"  >
                                                            <option  value="Yes">Yes</option>
                                                            <option  value="No">No</option>
                                                            <option  value="Pending">Pending</option>
                                                            <option  value="NA">NA</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="comcl.checklists[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="container-fluid" v-for="(repcl, index) in checklists.qc_checklist.reportChecklist">
                                            <h4> [[repcl.name]] </h4>
                                            <table class="table table-responsive">
                                                <thead>
                                                <tr class="d-flex">
                                                    <th class="col-1">#</th>
                                                    <th class="col-4">Check</th>
                                                    <th class="col-2">Input</th>
                                                    <th class="col-5">Remarks</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr v-for="(cl,index) in repcl.checklists" class="d-flex" >
                                                    <td class="col-1">[[index+1]]</td>
                                                    <td class="col-4" style="white-space: unset;" >[[cl.check]]</td>
                                                    <td class="col-2 pl-1 pr-1">
                                                        <select class="form-control" v-model="repcl.checklists[index].input">
                                                            <option  value="Yes">Yes</option>
                                                            <option  value="No">No</option>
                                                            <option  value="Pending">Pending</option>
                                                            <option  value="NA">NA</option>
                                                        </select>
                                                    </td>
                                                    <td class="col-5">
                                                        <textarea class="form-control" rows="3" v-model="repcl.checklists[index].remarks" placeholder="Enter remarks here"></textarea>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        {% if request.user|has_group:"QC" %}
                                        <div class="row" v-if="report.status=='QC'">
                                            <div class="col-md-6 col-6">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                            </div>
                                            <div class="col-md-6 col-6">
                                                <button type="button" @click="addchecklists" class="btn btn-primary">Save changes</button>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>


                        <div class="row justify-content-end" >
                            <div class="col-lg-6 text-center col-sm-6" v-if="revert">
                                <button type="button" class="btn btn-lg btn-warning" @click="submitreport" value="0"> Revert Back </button>
                            </div>
                            <div class="col-lg-6 text-center flacol-sm-6" v-if="proceed">
                                <button type="button" class="btn btn-lg btn-success" @click="submitreport" value="1">
                                 {% if request.user|has_group:"CRM" %}
                                    Publish
                                 {% endif %}
                                 {% if not request.user|has_group:"CRM" %}
                                    Proceed Forward
                                 {% endif %}


                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <footer class="footer pt-0">
                    <div class="row align-items-center justify-content-lg-between">
                        <div class="col-lg-6">
                            <div class="copyright text-center text-lg-left text-muted">
                                &copy; 2019 <a href="https://www.firstcourse.in" class="font-weight-bold ml-1" target="_blank">FirstCourse</a>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                                <li class="nav-item">
                                    <a href="https://www.firstcourse.in" class="nav-link" target="_blank">FirstCourse</a>
                                </li>
                                <li class="nav-item">
                                    <a href="https://www.firstcourse.in/aboutus" class="nav-link" target="_blank">About Us</a>
                                </li>
                                <!--                                <li class="nav-item">-->
                                <!--                                    <a href="http://blog.creative-tim.com" class="nav-link" target="_blank">Blog</a>-->
                                <!--                                </li>-->
                                <!--                                <li class="nav-item">-->
                                <!--                                    <a href="https://www.creative-tim.com/license" class="nav-link" target="_blank">License</a>-->
                                <!--                                </li>-->
                            </ul>
                        </div>
                    </div>
                </footer>
            </div>
            <div class="modal fade" id="PLTask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Profit Loss Statement</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">

                            <form method="post" enctype="multipart/form-data" id="P_Lform1">
                                {% csrf_token %}
                                <div class="custom-file">
                                    <input type="file" name="pl_qb_in_file1" id="id_pl_qb_in_file1" class="custom-file-input" lang="en" required>
                                    <label class="custom-file-label" for="id_pl_qb_in_file1">QB Input File</label>
                                </div>


                                <div class="custom-file">
                                    <input type="file" name="pl_cat_in_file1" id="id_pl_cat_in_file1" class="custom-file-input" lang="en" required>
                                    <label class="custom-file-label" for="id_pl_cat_in_file1">Category list</label>
                                </div>


                                <input type="number" name="report_id" id="id_report_id" :value="reportid" hidden class="form-control">
                                <input type="text" name="report_type" id="id_report_type" value="P_L" hidden class="form-control-file">

                                <input id="PLSubmit1" class="reportsubmit btn btn-primary btn-round btn-lg btn-block mb-3" type="button" value="Generate P-L Report">
                                <input type="hidden" name="next" value="{{ next }}">

                            </form>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal fade" id="GSTTask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">GST Dialog</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form method="post" enctype="multipart/form-data" id="GSTform1">
                                <div class="card card-login card-plain">
                                    {% csrf_token %}
                                    <div class="card-header ">
                                        <h5>GST Statement</h5>
                                    </div>
                                    <div class="card-body">


                                        <label>
                                            Input for Input Tax Credit
                                            <input type="file" name="gst_input_tax_credit" id="id_gst_input_tax_credit1" class="form-control-file">
                                        </label>

                                        <label>
                                            B2C Input File
                                            <input type="file" name="gst_input_b2c" id="id_gst_input_b2c1" class="form-control-file">
                                        </label>

                                        <label>
                                            B2B Input File
                                            <input type="file" name="gst_input_b2b" id="id_gst_input_b2b1" class="form-control-file">
                                        </label>

                                        <input type="number" name="report_id" id="id_report_id" :value="reportid" hidden class="form-control">
                                        <input type="text" name="report_type" id="id_report_type" value="GST" hidden class="form-control-file">

                                    </div>

                                    <div class="card-footer ">
                                        <input id="GSTSubmit1" class="reportsubmit btn btn-primary btn-round btn-lg btn-block mb-3" type="button" value="Generate GST Report">
                                        <input type="hidden" name="next" value="{{ next }}">
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal fade" id="SDLRTask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Swiggy Dump Level Reconciliation</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form method="post" enctype="multipart/form-data" id="SW_DUMP_Form1" >
                                <div class="card card-login card-plain">
                                    {% csrf_token %}
                                    <div class="card-body">

                                        <label>
                                            Input Data
                                            <input type="file" name="input_data_upload" id="id_input_data_upload" class="form-control-file">
                                        </label>
                                        <label>
                                            Weekly Mail
                                            <input type="file" name="weekly_mail_upload" id="id_weekly_mail_upload" class="form-control-file">
                                        </label>
                                        <label>
                                            Master Data
                                            <input type="file" name="master_data_upload" id="id_master_data_upload" class="form-control-file">
                                        </label>

                                        <input type="number" name="report_id" id="id_report_id" :value="reportid" hidden class="form-control">
                                        <input type="text" name="report_type" id="id_report_type" value="SW_DUMP" hidden class="form-control-file">
                                    </div>

                                    <div class="card-footer ">
                                        <input id="SW_DUMP_Submit1" class="reportsubmit btn btn-primary btn-round btn-lg btn-block mb-3" type="button" value="Generate Swiggy Dump Level Report">
                                        <input type="hidden" name="next" value="{{ next }}">
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal fade" id="PETask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Purchase Efficiency</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">

                            <form method="post" enctype="multipart/form-data" id="P_Eform1">
                                <div class="card card-login card-plain">
                                    {% csrf_token %}
                                    <div class="card-body">

                                        <label>
                                            Purchase Efficiency Input File
                                            <input type="file" name="pe_input_file" id="id_pe_input_file" class="form-control-file">
                                        </label>

                                        <input type="number" name="report_id" id="id_report_id" :value="reportid" hidden class="form-control">
                                        <input type="text" name="report_type" id="id_report_type" value="PUR_EFF" hidden class="form-control-file">
                                    </div>

                                    <div class="card-footer ">
                                        <input id="PESubmit1" class="reportsubmit btn btn-primary btn-round btn-lg btn-block mb-3" type="button" value="Generate Purchase Efficiency Report">
                                        <input type="hidden" name="next" value="{{ next }}">
                                    </div>
                                </div>

                            </form>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal fade" id="CATask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Consumption Analysis</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">

                            <form method="post" enctype="multipart/form-data" id="CAform1">
                                <div class="card card-login card-plain">
                                    {% csrf_token %}
                                    <div class="card-body">
                                        <div class="form-group">
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="ni ni-calendar-grid-58"></i></span>
                                                </div>
                                                <input class="form-control datepicker" id="datepicker" v-model="report_date" placeholder="Select date" type="text">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>
                                                Closing Stock For Current Month ([[ m0 ]])
                                                <input type="file" name="cs_m0_input_file" id="id_cs_m0_file" class="form-control-file">
                                            </label>
                                            <label>
                                                Closing Stock For ([[ m3 ]])
                                                <input type="file" name="cs_m3_input_file" id="id_cs_m3_file" class="form-control-file">
                                            </label>
                                            <label>
                                                Closing Stock For ([[ m2 ]])
                                                <input type="file" name="cs_m2_input_file" id="id_cs_m2_file" class="form-control-file">
                                            </label>
                                            <label>
                                                Closing Stock For ([[ m1 ]])
                                                <input type="file" name="cs_m1_input_file" id="id_cs_m1_file" class="form-control-file">
                                            </label>


                                        </div>
                                        <div class="form-group">
                                            <label>
                                                Opening Stock For Current Month ([[ m0 ]])
                                                <input type="file" name="os_m0_input_file" id="id_os_m0_file" class="form-control-file">
                                            </label>
                                            <label>
                                                Opening Stock For ([[ m3 ]])
                                                <input type="file" name="os_m3_input_file" id="id_os_m3_file" class="form-control-file">
                                            </label>
                                            <label>
                                                Opening Stock For ([[ m2 ]])
                                                <input type="file" name="os_m2_input_file" id="id_os_m2_file" class="form-control-file">
                                            </label>
                                            <label>
                                                Opening Stock For ([[ m1 ]])
                                                <input type="file" name="os_m1_input_file" id="id_os_m1_file" class="form-control-file">
                                            </label>
                                        </div>

                                        <div class="form-group">
                                            <label>
                                                Purchase File
                                            </label>
                                            <input type="file" name="ca_pur_file" id="id_ca_pur_file" class="form-control-file">

                                        </div>


                                        <input type="number" name="report_id" id="id_report_id" :value="reportid" hidden class="form-control">
                                        <input type="text" name="report_type" id="id_report_type" value="CON_ANA" hidden class="form-control-file">
                                    </div>

                                    <div class="card-footer ">
                                        <input id="CASubmit1" class="reportsubmit btn btn-primary btn-round btn-lg btn-block mb-3" type="button" value="Generate Consumption Analysis Report">
                                        <input type="hidden" name="next" value="{{ next }}">
                                    </div>
                                </div>

                            </form>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal fade" id="SCRTask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Sales Channel Reconciliation Task</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">

                            <form method="post" enctype="multipart/form-data" id="SCRform1">
                                <div class="card card-login card-plain">
                                    {% csrf_token %}
                                    <div class="card-body">
                                        <div class="form-group">
                                            <h6> Input files</h6>
                                            <div class="row">
                                                <div class="col-6">
                                                    <label>
                                                        Bank Transaction File
                                                        <input type="file" name="bank_transaction_input_file" id="id_bank_transaction_file" class="form-control-file">
                                                    </label>
                                                </div>
                                                <div class="col-6">
                                                    <label>
                                                        Swiggy File
                                                        <input type="file" name="swiggy_input_file" id="id_swiggy_file" class="form-control-file">
                                                    </label>
                                                </div>
                                                <div class="col-6">
                                                    <label>
                                                        Zomato File
                                                        <input type="file" name="zomato_input_file" id="id_zomato_file" class="form-control-file">
                                                    </label>
                                                </div>
                                                <div class="col-6">
                                                    <label>
                                                        Dunzo File
                                                        <input type="file" name="dunzo_input_file" id="id_dunzo_file" class="form-control-file">
                                                    </label>
                                                </div>
                                                <div class="col-6">
                                                    <label>
                                                        NearBuy File
                                                        <input type="file" name="nearbuy_input_file" id="id_nearbuy_file" class="form-control-file">
                                                    </label>
                                                </div>
                                                <div class="col-6">
                                                    <label>
                                                        Dineout File
                                                        <input type="file" name="dineout_input_file" id="id_dineout_file" class="form-control-file">
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <h6> POS numbers </h6>
                                            <div class="row">
                                                <div class="col-6">
                                                    <label>
                                                        Swiggy POS
                                                        <input type="text" name="swiggy_input_pos" id="id_swiggy_pos" class="form-control">
                                                    </label>
                                                </div>
                                                <div class="col-6">
                                                    <label>
                                                        Zomato POS
                                                        <input type="text" name="zomato_input_pos" id="id_zomato_pos" class="form-control">
                                                    </label>
                                                </div>
                                                <div class="col-6">
                                                    <label>
                                                        Dunzo POS
                                                        <input type="text" name="dunzo_input_pos" id="id_dunzo_pos" class="form-control">
                                                    </label>
                                                </div>
                                                <div class="col-6">
                                                    <label>
                                                        NearBuy POS
                                                        <input type="text" name="nearbuy_input_pos" id="id_nearbuy_pos" class="form-control">
                                                    </label>
                                                </div>
                                                <div class="col-6">
                                                    <label>
                                                        Dineout POS
                                                        <input type="text" name="dineout_input_pos" id="id_dineout_pos" class="form-control">
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <input type="number" name="report_id" id="id_report_id" :value="reportid" hidden class="form-control">
                                        <input type="text" name="report_type" id="id_report_type" value="S_C_R" hidden class="form-control-file">
                                    </div>

                                    <div class="card-footer ">
                                        <input id="SCRSubmit1" class="reportsubmit btn btn-primary btn-round btn-lg btn-block mb-3" type="button" value="Generate SCR Report">
                                        <input type="hidden" name="next" value="{{ next }}">
                                    </div>
                                </div>

                            </form>
                        </div>

                    </div>
                </div>
            </div>
        </div>



{% include 'footer.html' %}
<script src="{% static 'js/insights.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@beta/dist/js.cookie.min.js"></script>
<script src="{% static 'js/axios.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/js/select2.min.js"></script>
<script src ="https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.1/qs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.4.456/pdf.min.js"></script>
<script src="{% static 'argon/assets/js/pdfobject.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>


<script type="text/javascript">
    $(document).ready(function(){
        var csrftoken = Cookies.get('csrftoken');
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

        axios.interceptors.request.use(config => {
            // log a message before any HTTP request is sent
            console.log('Request was sent');
            addspinner();

            return config;
        });
        function addspinner(){
            $(".overlay").addClass("d-block");
            $(".overlay").removeClass("d-none");
            $(".loader").removeClass("d-none");
            $(".loader").addClass("d-block",400);

            $('.customer_select').val(null).trigger('change');

        }
        function removespinner(){
            $(".overlay").addClass("d-none");
            $(".overlay").removeClass("d-block");
            $(".loader").removeClass("d-block",400);
            $(".loader").addClass("d-none",400);
        }
        axios.interceptors.response.use(function (response) {
            // Any status code that lie within the range of 2xx cause this function to trigger
            // Do something with response data
            console.log(response);
            console.log("response");
            removespinner();
            return response;
        }, function (error) {
            // Any status codes that falls outside the range of 2xx cause this function to trigger
            // Do something with response error
            removespinner();
            return Promise.reject(error);
        });


        $("#PLSubmit1").on('click', function(event){
            axios.defaults.xsrfCookieName = csrftoken;
            axios.defaults.xsrfHeaderName = "X-CSRFToken";
            console.log("Hey PL Submit1 Clicked");

            let formData = new FormData();
            formData.append('report_id',$("#P_Lform1").find('input[name="report_id"]').val());
            formData.append('report_type',$("#P_Lform1").find('input[name="report_type"]').val());
            formData.append('pl_qb_in_file', $("#P_Lform1").find('input[name="pl_qb_in_file1"]')[0].files[0]);
            formData.append('pl_cat_in_file', $("#P_Lform1").find('input[name="pl_cat_in_file1"]')[0].files[0]);
            {#console.log($("#P_Lform1").find('input[name="report_id"]').val());#}
            {#console.log(formData);#}
            axios.post( '/reports/process/report/',
                formData,
                {
                    headers: {
                        'Content-Type': 'multipart/form-data',
                        'X-CSRFToken':csrftoken
                    }
                }
            ).then(function(data1){
                console.log('SUCCESS!!');
                showNotification("top","right","success",data1.data.message);
                $("#P_Lform1").trigger("reset");
                $('#PLTask').modal('hide');
                app.task_id=data1.data.taskid;
                app.get_task_status();
                //location.reload();
                // window.location.href = "/dashboard";

            }).catch(function(error){
                console.log(error)
                // showNotification("top","right","danger",error.data.message);
            });
        });
        $("#SW_DUMP_Submit1").on('click', function(event){
            axios.defaults.xsrfCookieName = csrftoken;
            axios.defaults.xsrfHeaderName = "X-CSRFToken";
            console.log($("#SW_DUMP_Form1").find('input[name="report_id"]').val());
            let formData = new FormData();
            formData.append('report_type',$("#SW_DUMP_Form1").find('input[name="report_type"]').val());
            formData.append('report_id',$("#SW_DUMP_Form1").find('input[name="report_id"]').val());
            formData.append('input_data_in_file', $("#SW_DUMP_Form1").find('input[name="input_data_upload"]')[0].files[0]);
            formData.append('weekly_mail_in_file', $("#SW_DUMP_Form1").find('input[name="weekly_mail_upload"]')[0].files[0]);
            formData.append('master_data_in_file', $("#SW_DUMP_Form1").find('input[name="master_data_upload"]')[0].files[0]);

            axios.post( '/reports/process/report/',
                formData,
                {
                    headers: {
                        'Content-Type': 'multipart/form-data',
                        'X-CSRFToken':csrftoken
                    }
                }
            ).then(function(data1){
                console.log('SUCCESS!!');
                console.log(data1);
                showNotification("top","right","success",data1.data.message);
                $("#SW_DUMP_Form").trigger("reset");
                app.task_id=data1.data.taskid;
                app.get_task_status();
                app.update_table();
                $('#SDLRTask').modal('hide');
                // window.location.href = "/dashboard";

            }).catch(function(error){
                showNotification("top","right","danger",error.response.data.message);
            });
        });
        $("#GSTSubmit1").on('click', function(event){

            console.log("GST submit called");
            axios.defaults.xsrfCookieName = csrftoken;
            axios.defaults.xsrfHeaderName = "X-CSRFToken";

            let formData = new FormData();
            console.log($("#GSTform1").find('input[name="report_type"]').val());
            console.log($("#GSTform1").find('input[name="report_id"]').val());
            formData.append('report_type',$("#GSTform1").find('input[name="report_type"]').val());
            formData.append('report_id',$("#GSTform1").find('input[name="report_id"]').val());
            formData.append('gst_input_tax_credit', $("#GSTform1").find('input[name="gst_input_tax_credit"]')[0].files[0]);
            formData.append('gst_input_b2b', $("#GSTform1").find('input[name="gst_input_b2b"]')[0].files[0]);
            formData.append('gst_input_b2c', $("#GSTform1").find('input[name="gst_input_b2c"]')[0].files[0]);

            axios.post( '/reports/process/report/',
                formData,
                {
                    headers: {
                        'Content-Type': 'multipart/form-data',
                        'X-CSRFToken':csrftoken
                    }
                }
            ).then(function(data1){
                console.log('SUCCESS!!');

                //console.log(data.message);
                showNotification("top","right","success",data1.data.message);
                $("#GSTform1").trigger("reset");
                $('#GSTTask').modal('hide');
                app.task_id=data1.data.taskid;
                app.get_task_status();
                //location.reload();

                // window.location.href = "/dashboard";

            }).catch(function(error){
                showNotification("top","right","danger",error.response.data.message);
            });

        });
        $("#PESubmit1").on('click', function(event){

            console.log("PE submit called");
            axios.defaults.xsrfCookieName = csrftoken;
            axios.defaults.xsrfHeaderName = "X-CSRFToken";

            let formData = new FormData();
            formData.append('report_type',$("#P_Eform1").find('input[name="report_type"]').val());
            console.log($("#P_Eform1").find('input[name="report_id"]').val());
            formData.append('report_id',$("#P_Eform1").find('input[name="report_id"]').val());
            formData.append('pe_input_file', $("#P_Eform1").find('input[name="pe_input_file"]')[0].files[0]);


            axios.post( '/reports/process/report/',
                formData,
                {
                    headers: {
                        'Content-Type': 'multipart/form-data',
                        'X-CSRFToken':csrftoken
                    }
                }
            ).then(function(data1){
                console.log('SUCCESS!!');
                //console.log(data.message);
                showNotification("top","right","success",data1.data.message);
                $("#P_Eform1").trigger("reset");
                $('#PETask').modal('hide');
                app.task_id=data1.data.taskid;
                app.get_task_status();
                // location.reload();

                // window.location.href = "/dashboard";

            }).catch(function(error){
                showNotification("top","right","danger",error.response.data.message);
            });

        });
        $("#CASubmit1").on('click', function(event){

            console.log("CA submit called");
            axios.defaults.xsrfCookieName = csrftoken;
            axios.defaults.xsrfHeaderName = "X-CSRFToken";

            let formData = new FormData();
            formData.append('report_type',$("#CAform1").find('input[name="report_type"]').val());
            formData.append('report_id',$("#CAform1").find('input[name="report_id"]').val());
            m0 = moment(app.report_date).format('MM YYYY');
            m1 = moment(app.report_date).subtract(3, 'months').format('MM YYYY');
            m2 = moment(app.report_date).subtract(2, 'months').format('MM YYYY');
            m3 = moment(app.report_date).subtract(1, 'months').format('MM YYYY');
            dates=[m1,m2,m3,m0];

            formData.append('dates',dates);
            formData.append('cs_m1_input_file', $("#CAform1").find('input[name="cs_m1_input_file"]')[0].files[0]);
            formData.append('cs_m2_input_file', $("#CAform1").find('input[name="cs_m2_input_file"]')[0].files[0]);
            formData.append('cs_m3_input_file', $("#CAform1").find('input[name="cs_m3_input_file"]')[0].files[0]);
            formData.append('cs_cur_input_file', $("#CAform1").find('input[name="cs_m0_input_file"]')[0].files[0]);

            formData.append('os_m1_input_file', $("#CAform1").find('input[name="os_m1_input_file"]')[0].files[0]);
            formData.append('os_m2_input_file', $("#CAform1").find('input[name="os_m2_input_file"]')[0].files[0]);
            formData.append('os_m3_input_file', $("#CAform1").find('input[name="os_m3_input_file"]')[0].files[0]);
            formData.append('os_cur_input_file', $("#CAform1").find('input[name="os_m0_input_file"]')[0].files[0]);

            formData.append('ca_pur_file', $("#CAform1").find('input[name="ca_pur_file"]')[0].files[0]);

            axios.post( '/reports/process/report/',
                formData,
                {
                    headers: {
                        'Content-Type': 'multipart/form-data',
                        'X-CSRFToken':csrftoken
                    }
                }
            ).then(function(data1){
                console.log('SUCCESS!!');
                //console.log(data.message);
                showNotification("top","right","success",data1.data.message);
                $("#CAform1").trigger("reset");
                $('#CATask').modal('hide');
                app.task_id=data1.data.taskid;
                app.get_task_status();
                // location.reload();

                // window.location.href = "/dashboard";

            }).catch(function(error){
                showNotification("top","right","danger",error.response.data.message);
            });

        });
        $("#SCRSubmit1").on('click', function(event){

            axios.defaults.xsrfCookieName = csrftoken;
            axios.defaults.xsrfHeaderName = "X-CSRFToken";

            let formData = new FormData();
            formData.append('report_type',$("#SCRform1").find('input[name="report_type"]').val());
            formData.append('report_id',$("#SCRform1").find('input[name="report_id"]').val());

            formData.append('swiggy_input_file', $("#SCRform1").find('input[name="swiggy_input_file"]')[0].files[0]);
            formData.append('zomato_input_file', $("#SCRform1").find('input[name="zomato_input_file"]')[0].files[0]);
            formData.append('dunzo_input_file', $("#SCRform1").find('input[name="dunzo_input_file"]')[0].files[0]);
            formData.append('nearbuy_input_file', $("#SCRform1").find('input[name="nearbuy_input_file"]')[0].files[0]);
            formData.append('dineout_input_file', $("#SCRform1").find('input[name="dineout_input_file"]')[0].files[0]);
            formData.append('bank_transaction_input_file', $("#SCRform1").find('input[name="bank_transaction_input_file"]')[0].files[0]);

            formData.append('swiggy_input_pos', $("#SCRform1").find('input[name="swiggy_input_pos"]').val());
            formData.append('zomato_input_pos', $("#SCRform1").find('input[name="zomato_input_pos"]').val());
            formData.append('dunzo_input_pos', $("#SCRform1").find('input[name="dunzo_input_pos"]').val());
            formData.append('nearbuy_input_pos', $("#SCRform1").find('input[name="nearbuy_input_pos"]').val());
            formData.append('dineout_input_pos', $("#SCRform1").find('input[name="dineout_input_pos"]').val())

            axios.post( '/reports/process/report/',
                formData,
                {
                    headers: {
                        'Content-Type': 'multipart/form-data',
                        'X-CSRFToken':csrftoken
                    }
                }
            ).then(function(data1){
                console.log('SUCCESS!!');
                //console.log(data.message);
                showNotification("top","right","success",data1.data.message);
                $("#SCRform1").trigger("reset");
                $('#SCRTask').modal('hide');
                app.task_id=data1.data.taskid;
                app.get_task_status();
                // location.reload();

                // window.location.href = "/dashboard";

            }).catch(function(error){
                showNotification("top","right","danger",error.response.data.message);
            });

        });
        function showNotification(from, align,color,message){
            $.notify({
                icon: "now-ui-icons ui-1_bell-53",
                message: message

            },{
                type: color,
                timer: 2000,
                placement: {
                    from: from,
                    align: align
                }
            });
        }


    });
</script>

<script type="text/javascript">
    Vue.component('commentitem', {
        props: ['id','comment_description','comment_category','comment_author','comment_type','comment_remarks','comment_datetime','comment_delete','comment_modify','button_visible'],
        delimiters: ['[[', ']]'],
        template: '                         <tr>\n' +
            '                            <td class="text-center">[[ id ]]</td>\n' +
            '                            <td class="text-left">[[comment_category]]</td>\n' +
            '                            <td class="text-left">[[comment_type]]</td>\n' +
            '                            <td class="text-left" style="word-break: break-word;white-space: normal;">[[ comment_description ]]</td>\n' +
            '                            <td class="text-left" style="word-break: break-word;white-space: normal;">[[ comment_remarks ]]</td>\n' +
            '                            <td class="text-left"><button class="btn btn-sm btn-warning" v-if="button_visible" @click="editcheckpoint(comment_modify)"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button><button class="btn btn-sm btn-danger" v-if="button_visible" @click="deletecheckpoint(comment_delete)"><i class="ni ni-fat-remove" ></i></button></td>\n' +
            '                        </tr> ',
        methods:{
            deletecheckpoint:function(ind){

                var csrftoken = Cookies.get('csrftoken');
                function csrfSafeMethod(method) {
                    // these HTTP methods do not require CSRF protection
                    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                }

                $.ajaxSetup({
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                });

                axios.interceptors.request.use(config => {
                    // log a message before any HTTP request is sent
                    console.log('Request was sent');
                    addspinner();
                    return config;
                });

                function addspinner(){
                    $(".overlay").addClass("d-block");
                    $(".overlay").removeClass("d-none");
                    $(".loader").removeClass("d-none");
                    $(".loader").addClass("d-block",400);
                }

                function removespinner(){
                    $(".overlay").addClass("d-none");
                    $(".overlay").removeClass("d-block");
                    $(".loader").removeClass("d-block",400);
                    $(".loader").addClass("d-none",400);
                }
                axios.interceptors.response.use(function (response) {
                    // Any status code that lie within the range of 2xx cause this function to trigger
                    // Do something with response data
                    removespinner();
                    return response;
                }, function (error) {
                    // Any status codes that falls outside the range of 2xx cause this function to trigger
                    // Do something with response error
                    removespinner();
                    return Promise.reject(error);
                });
                axios.defaults.xsrfCookieName = csrftoken;
                axios.defaults.xsrfHeaderName = "X-CSRFToken";

                let formData = new FormData();
                formData.append('reportid', app.reportid);
                formData.append('commentid',ind);
                formData.append('entity','comments');

                axios.post( '/reports/delete/entity/',
                    formData,
                    {
                        headers: {
                            'Content-Type': 'multipart/form-data',
                            'X-CSRFToken':csrftoken
                        }
                    }


                ).then(function(data1){
                    console.log('SUCCESS!!');
                    app.showNotification("top","right","success",data1.data.message);
                    app.update_table();
                    // window.location.href = "/dashboard";

                }).catch(function(error){
                    app.showNotification("top","right","danger",error.response.data.message);
                });
            },
                editcheckpoint:function(ind){

                app.current_comment_index=ind;
                console.log("edit check point");
                console.log(app.comments[ind]);


                if(app.report.report_type == "Profit Statement"){

                    $('#edit_insight_category').select2();
                    $('#edit_insight_type').select2();
                    $('#edit_insight_notes').select2();
                    $("#edit_insight_category option").remove();

                     var cat_url='/reports/get/insights/?type=category';
                    axios.get(cat_url).then(function (response) {

                       $.each(response.data, function(key,value) {

                          var option = new Option(value.name, value.name, false, false);
                          //console.log(option);
                          $('#edit_insight_category').append(option);

                        });

                        $('#edit_insight_category').val(app.comments[ind].comment_category).trigger('change');



                    }).catch(function(error){
                    console.log("Error");
                    console.log(error);
                    });


                    $('#edit_insight_category').on('change',function(){
                    $("#edit_insight_type option").remove();

                        var url='/reports/get/insights/?type=type&cat='+String($('#edit_insight_category').val());
                        axios.get(url).then(function (response) {
                        $("#edit_insight_type option").remove();
                        var option = new Option('Select', 'Select', false, false);

                          $('#edit_insight_type').append(option);



                       $.each(response.data, function(key,value) {

                          var option = new Option(value.name, value.name, false, false);

                          $('#edit_insight_type').append(option);

                        });


                       $('#edit_insight_type').val(app.comments[ind].comment_type).trigger('change');

                    }).catch(function(error){
                    console.log("Error");
                    console.log(error);
                    });

                    });



                    $('#edit_insight_type').on('change',function(){

                        $("#edit_insight_notes option").remove();

                        var url='/reports/get/insights/?type=notes&intype='+String($('#edit_insight_type').val())+'&cat='+String($('#edit_insight_category').val());
                        axios.get(url).then(function (response) {
                        $("#edit_insight_notes option").remove();
                        var option = new Option('Select', 'Select', false, false);

                          $('#edit_insight_notes').append(option);

                       $.each(response.data, function(key,value) {
                         //console.log(value.notes);

                          var option = new Option(value.notes, value.notes, false, false);

                          $('#edit_insight_notes').append(option);

                        });


                    }).catch(function(error){
                    console.log("Error");
                    console.log(error);
                    });

                    });
                    console.log("edit insight notes "+$('#edit_insight_notes').length);
                    $('#edit_insight_notes').on('change',function(){
                        console.log("test edit insight notes");
                        console.log(app.comments[ind].comment_description);
                        if($('#edit_insight_notes').val()!=null)
                         {
                            console.log($('#edit_insight_notes').val());
                            $("#edit_insights_description").val($('#edit_insight_notes').val());
                         }
                    });

                }

                $('#EditcommentModal').modal('show');


            }
        },

    });

    Vue.component('anomalyitem', {
        props: ['id','anomaly_description','anomaly_comment','anomaly_criticality','anomaly_author','anomaly_datetime'],
        delimiters: ['[[', ']]'],
        template: '                         <tr>\n' +
            '                            <td class="text-center">[[ id ]]</td>\n' +
            '                            <td>[[anomaly_description]]</td>\n' +
            '                            <td>[[anomaly_comment]]</td>\n' +
            '                            <td>[[anomaly_criticality]]</td>\n' +
            '                            <td>[[anomaly_author]]</td>\n' +
            '                            <td>[[anomaly_datetime]]</td>\n' +
            '                        </tr> '
    });



    var app = new Vue({
        delimiters: ['[[', ']]'],
        el: '#panel',
        data: {
            message: 'Hello Vue!',
            comments:[],
            anomalies:[],
            activities:[],
            checklists:[],
            report:[],
            init_query_date:'',
            final_query_date:'',  //Take the report month and year and set the value
            connected:false,
            current_report_id:'',
            current_comment_index:0,
            checklist_loaded:false,
            report_month:'',
            m1:'',
            m2:'',
            m3:'',
            m0:'',
            notes:'',
            report_year:'',
            report_date:'',
            reportid:{{ id }},
            current_insight_cat:'',
            proceed:false,
            revert:false,
            task_id:'',
            task_status:{
                "status":"",
                "traceback":""
            },
            reportTypeList:["P_L","CL_ST","GST","CON_ANA","S_C_R","SW_IN","SW_DUMP","TDS","PUR_EFF"],
            reportLevelList:["outlet","customer","legalentity","outlet","customer","customer","customer","customer","customer"],

        },
        methods:{
            get_task_status:function(){
                console.log("Calling get task status");
                var mytimer;
                function getstatus(){
                    console.log("getstatus");
                    var url='/reports/get/status/'+app.task_id+"/";
                    axios.get(url)
                        .then(function(response){
                            app.task_status.status=response.data.status;
                            app.task_status.traceback=response.data.traceback;
                            if(app.task_status.status=="SUCCESS" || app.task_status.status=="FAILURE"){
                                clearInterval(mytimer);
                                if(app.task_status.status=="SUCCESS" ){
                                    location.reload();
                                }
                            }
                        });
                }
                if(this.task_id!=''){
                    mytimer = setInterval(getstatus,3000);
                }


            },
            checkReportOwner:function()
            {
                console.log("check owner");
                axios.get('/employees/get/myinfo')
                    .then(function (response) {
                        console.log("checkReportOwner get info success");

                        var groupArr=[];
                        $.each(response.data.groups,function(index,value){
                            groupArr.push(value.name);

                        });
                        if((app.report.status == 'Initiated' || app.report.status == 'Review' ) && groupArr.includes("Accountant"))
                        {
                            app.proceed=true;
                        }
                        else if(app.report.status == 'TL' && groupArr.includes("TeamLead"))
                        {
                            app.proceed=true;
                            app.revert=true;

                        }
                        else if(app.report.status == 'QC' && groupArr.includes("QC"))
                        {
                            app.proceed=true;
                            app.revert=true;

                        }
                        else if(app.report.status == 'CRM' && groupArr.includes("CRM"))
                        {
                            app.revert=true;
                            app.proceed=true;

                        }
                        else if(app.report.status == 'Published' && groupArr.includes("CRM"))
                        {
                            app.revert=true;
                        }
                        //  console.log("current owner : "+app.proceed);

                    }).catch(function(error){
                    console.log("Error");
                });
            },
            getnotifications: function(){

            },
            printnotifications: function(){

            },
            processjsontask:function(type,id){
                console.log("process json task");
                this.current_report_id=id;
                console.log(type)
                var csrftoken = Cookies.get('csrftoken');
                if(type === "Profit Statement")
                {

                    axios.defaults.xsrfCookieName = csrftoken;
                    axios.defaults.xsrfHeaderName = "X-CSRFToken";

                    let formData = new FormData();
                    formData.append('report_id',$("#P_Lform1").find('input[name="report_id"]').val());
                    formData.append('report_type',$("#P_Lform1").find('input[name="report_type"]').val());
                    axios.post( '/reports/process/apireport/',
                        formData,
                        {
                            headers: {
                                'Content-Type': 'multipart/form-data',
                                'X-CSRFToken':csrftoken
                            }
                        }
                    ).then(function(data1){
                        console.log('SUCCESS!!');
                        app.showNotification("top","right","success",data1.data.message);
                        {#app.task_id=data1.data.taskid;#}
                        {#app.get_task_status();#}
                        //location.reload();
                        // window.location.href = "/dashboard";

                    }).catch(function(error){
                        console.log(error)
                        // showNotification("top","right","danger",error.data.message);
                    });


                }
                else if(type == "GST Summary")
                {


                }
                else if(type == "Swiggy Dump Level Reconciliation")
                {


                }
                else if(type == "Purchase Efficiency")
                {


                }
                else if(type == "Consumption Analysis")
                {


                }
                else if(type == "Sales Channel Reconciliation")
                {


                }
            },
            processtask:function(type,id){
                this.current_report_id=id;
                console.log(type)

                if(type === "Profit Statement")
                {
                    $('#PLTask').modal('show');

                }
                else if(type == "GST Summary")
                {
                    $("#GSTTask").modal('show');

                }
                else if(type == "Swiggy Dump Level Reconciliation")
                {
                    $("#SDLRTask").modal('show');

                }
                else if(type == "Purchase Efficiency")
                {
                    $("#PETask").modal('show');

                }
                else if(type == "Consumption Analysis")
                {
                    $("#CATask").modal('show');

                }
                else if(type == "Sales Channel Reconciliation")
                {
                    $("#SCRTask").modal('show');

                }
            },
            is_connected:function(){
                axios.get('/ext_api/qb/is_connected/')
                    .then(function (response) {
                        console.log(response.data.logged)
                        app.connected=response.data.logged;

                    }).catch(function(error){
                    console.log("Error");
                });
            },
            opencheckpointmodal:function(){
                console.log("Hey clicked");

                $('#commentModal').modal('show');
                $('#insight_type').select2({
                    ajax: {
                        placeholder: "Select the insight type",
                    },
                });

                $('#insight_notes').select2({
                    ajax: {
                        placeholder: "Select the insight notes",
                    },
                });

                $('#insight_category').select2({
                  ajax: {
                    url: '/reports/get/insights/?type=category',
                        type: 'GET',
                        dataType: 'json',
                        placeholder: "Select the insight category",
                        allowClear: true,
                        tags: true,
                    processResults: function (data) {
                    // Transforms the top-level key of the response object from 'items' to 'results'
                        var data = $.map(data, function (obj) {
                            obj.text = obj.name ;
                            obj.id = obj.name;// replace name with the property used for the text
                            return obj;
                        });
                        return {
                            results: data
                        };
                    },
                  },
                });

                $('#insight_category').on('change',function(){
                    var url='/reports/get/insights/?type=type&cat='+String($('#insight_category').val());
                    $('#insight_type').select2({
                          ajax: {
                            url: url,
                              type: 'GET',
                                dataType: 'json',
                                placeholder: "Select the insight type",
                            allowClear: true,
                            tags: true,
                            processResults: function (data) {
                            // Transforms the top-level key of the response object from 'items' to 'results'
                                var data = $.map(data, function (obj) {
                                    obj.text = obj.name ;
                                    obj.id = obj.name;// replace name with the property used for the text
                                    return obj;
                                });

                                return {
                                    results: data
                                };
                            },
                          },
                    });
                });

                $('#insight_type').on('change',function(){
                    var url='/reports/get/insights/?type=notes&intype='+String($('#insight_type').val())+'&cat='+String($('#insight_category').val());
                    $('#insight_notes').select2({
                          ajax: {
                            url: url,
                              type: 'GET',
                                dataType: 'json',
                                placeholder: "Select the insight notes",
                            allowClear: true,
                            tags: true,
                            processResults: function (data) {
                            // Transforms the top-level key of the response object from 'items' to 'results'
                                var data = $.map(data, function (obj) {
                                    obj.text = obj.notes ;
                                    obj.id = obj.notes;// replace name with the property used for the text
                                    return obj;
                                });

                                return {
                                    results: data
                                };
                            },
                          },
                    });
                });

                $('#insight_notes').on('change',function(){
                    app.notes=$('#insight_notes').val();
                })
                $('#insight_category').val(null).trigger('change');
                $('#insight_type').val(null).trigger('change');
                $('#insight_notes').val(null).trigger('change');
                //this.comments.push({'id':0,'description':'','comment':'','status':'NA'})
            },
            addcheckpoint:function(){
                var id=this.comments.length+1;
                if(this.report.report_type=="Profit Statement")
                {

                    var category=$("#insight_category").val();
                    console.log("Category in insights is ",category);
                    var type=$("#insight_type").val();
                    var remarks=$("#remarks").val()
                    this.comments.push({'id':id,'comment_description':this.notes,'comment_category':category,'comment_type':type,'comment_remarks':remarks});
                    console.log(this.comments);
                    $("#modal_description").val('');
                    $("#modal_category").val('');
                }
                else{
                    var remarks=$("#remarks").val()
                    this.comments.push({'id':id,'comment_remarks':remarks});
                }

                $('#commentModal').modal('hide');

                this.post_checkpoint(this.comments.length-1,'insert');
            },

            modifycheckpoint:function(){
                var id=this.comments.length+1;
                var category=$("#edit_insight_category").val();
                var type=$("#edit_insight_type").val();
                var remarks=$("#edit_remarks").val();
                var description=$("#edit_insights_description").val();
                this.comments[this.current_comment_index]={'id':this.current_comment_index,'comment_description':description,'comment_category':category,'comment_type':type,'comment_remarks':remarks};
                $('#EditcommentModal').modal('hide');
                this.post_checkpoint(this.current_comment_index,'modify');
            },

            addchecklists:function(){
              this.post_checklist();
            },
            openanomalymodal:function(){
                $('#anomalyModal').modal('show');
                //this.comments.push({'id':0,'description':'','comment':'','status':'NA'})
            },
            regenerate_report:function(){

                var csrftoken = Cookies.get('csrftoken');
                function csrfSafeMethod(method) {
                    // these HTTP methods do not require CSRF protection
                    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                }

                $.ajaxSetup({
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                });

                axios.interceptors.request.use(config => {
                    // log a message before any HTTP request is sent
                    console.log('Request was sent');
                    addspinner();
                    return config;
                });



                function addspinner(){
                    $(".overlay").addClass("d-block");
                    $(".overlay").removeClass("d-none");
                    $(".loader").removeClass("d-none");
                    $(".loader").addClass("d-block",400);

                    $('.customer_select').val(null).trigger('change');

                }
                function removespinner(){
                    $(".overlay").addClass("d-none");
                    $(".overlay").removeClass("d-block");
                    $(".loader").removeClass("d-block",400);
                    $(".loader").addClass("d-none",400);
                }
                axios.interceptors.response.use(function (response) {
                    // Any status code that lie within the range of 2xx cause this function to trigger
                    // Do something with response data
                    removespinner();
                    return response;
                }, function (error) {
                    // Any status codes that falls outside the range of 2xx cause this function to trigger
                    // Do something with response error
                    removespinner();
                    return Promise.reject(error);
                });
                axios.defaults.xsrfCookieName = csrftoken;
                axios.defaults.xsrfHeaderName = "X-CSRFToken";

                let formData = new FormData();

                formData.append('report_id', app.reportid);


                axios.post( '/reports/regenerate_report/',
                    formData,
                    {
                        headers: {
                            'Content-Type': 'multipart/form-data',
                            'X-CSRFToken':csrftoken
                        }
                    }
                ).then(function(data1){
                    console.log('SUCCESS!!');
                    app.showNotification("top","right","success",data1.data.message);
                    location.reload();
                    // window.location.href = "/dashboard";

                }).catch(function(error){
                    app.showNotification("top","right","danger",error.response.data.message);
                });
            },
            addanomaly:function() {
                var id = this.comments.length + 1;
                var description = $("#modal_anomaly_description").val();
                var comment1 = $("#modal_anomaly_comment").val();
                var criticality = $('#modal_anomaly_criticality').val();
                this.anomalies.push({'id': id, 'anomaly_description': description, 'anomaly_comment': comment1, 'anomaly_criticality': criticality})
                $('#anomalyModal').modal('hide');
                $("#modal_anomaly_description").val('');
                $("#modal_anomaly_comment").val('');
                $('#modal_anomaly_criticality').val('');
                this.post_anomaly();

            },
            showNotification: function (from, align,color,message){
                    $.notify({
                        icon: "now-ui-icons ui-1_bell-53",
                        message: message

                    },{
                        type: color,
                        timer: 2000,
                        placement: {
                            from: from,
                            align: align
                        }
                    });
            },
            post_checkpoint:function(ind,action){

                var values=this.comments[ind];

                var csrftoken = Cookies.get('csrftoken');
                function csrfSafeMethod(method) {
                    // these HTTP methods do not require CSRF protection
                    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                }

                $.ajaxSetup({
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                });

                axios.interceptors.request.use(config => {
                    // log a message before any HTTP request is sent
                    console.log('Request was sent');
                    addspinner();


                    return config;
                });

                function addspinner(){
                    $(".overlay").addClass("d-block");
                    $(".overlay").removeClass("d-none");
                    $(".loader").removeClass("d-none");
                    $(".loader").addClass("d-block",400);
                    $('.customer_select').val(null).trigger('change');
                }

                function removespinner(){
                    $(".overlay").addClass("d-none");
                    $(".overlay").removeClass("d-block");
                    $(".loader").removeClass("d-block",400);
                    $(".loader").addClass("d-none",400);
                }
                axios.interceptors.response.use(function (response) {
                    // Any status code that lie within the range of 2xx cause this function to trigger
                    // Do something with response data
                    removespinner();
                    return response;
                }, function (error) {
                    // Any status codes that falls outside the range of 2xx cause this function to trigger
                    // Do something with response error
                    removespinner();
                    return Promise.reject(error);
                });
                axios.defaults.xsrfCookieName = csrftoken;
                axios.defaults.xsrfHeaderName = "X-CSRFToken";

                let formData = new FormData();
                if(this.report.report_type=="Profit Statement"){

                    formData.append('comment_remarks',values['comment_remarks']);
                    formData.append('comment_type',values['comment_type']);
                    formData.append('comment_category',values['comment_category']);
                    formData.append('comment_description',values['comment_description']);
                    formData.append('reportid', app.reportid);
                    formData.append('entity','comments');
                    formData.append('action',action);
                    formData.append('commentid',ind);
                }
                else{

                    formData.append('comment_remarks',values['comment_remarks']);
                    formData.append('reportid', app.reportid);
                    formData.append('entity','comments');
                    formData.append('action',action);
                    formData.append('commentid',ind);
                }


                axios.post( '/reports/post/entity/',
                    formData,
                    {
                        headers: {
                            'Content-Type': 'multipart/form-data',
                            'X-CSRFToken':csrftoken
                        }
                    }
                ).then(function(data1){
                    console.log('SUCCESS!!');
                    app.showNotification("top","right","success",data1.data.message);
                    app.update_table();
                    // window.location.href = "/dashboard";

                }).catch(function(error){
                    app.showNotification("top","right","danger",error.response.data.message);
                });


            },
            post_checklist:function(){
                var values=JSON.stringify(this.checklists);

                console.log("Printing before posting checklists");
                console.log(JSON.stringify(values));
                var csrftoken = Cookies.get('csrftoken');
                function csrfSafeMethod(method) {
                    // these HTTP methods do not require CSRF protection
                    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                }

                $.ajaxSetup({
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                });

                axios.interceptors.request.use(config => {
                    // log a message before any HTTP request is sent
                    console.log('Request was sent');
                    addspinner();
                    return config;
                });

                function addspinner(){
                    $(".overlay").addClass("d-block");
                    $(".overlay").removeClass("d-none");
                    $(".loader").removeClass("d-none");
                    $(".loader").addClass("d-block",400);

                    $('.customer_select').val(null).trigger('change');

                }
                function removespinner(){
                    $(".overlay").addClass("d-none");
                    $(".overlay").removeClass("d-block");
                    $(".loader").removeClass("d-block",400);
                    $(".loader").addClass("d-none",400);
                }
                axios.interceptors.response.use(function (response) {
                    // Any status code that lie within the range of 2xx cause this function to trigger
                    // Do something with response data
                    removespinner();
                    return response;
                }, function (error) {
                    // Any status codes that falls outside the range of 2xx cause this function to trigger
                    // Do something with response error
                    removespinner();
                    return Promise.reject(error);
                });
                axios.defaults.xsrfCookieName = csrftoken;
                axios.defaults.xsrfHeaderNamefalse = "X-CSRFToken";
                let formData = new FormData();
                formData.append('checklists',values);
                formData.append('reportid', app.reportid);
                formData.append('entity','checklists');

                axios.post( '/reports/post/entity/',
                    formData,
                    {
                        headers: {
                            'Content-Type': 'multipart/form-data',
                            'X-CSRFToken':csrftoken
                        }
                    }
                ).then(function(data1){
                    console.log('SUCCESS!!');
                    app.showNotification("top","right","success",data1.data.message);
                    app.update_table();
                    // window.location.href = "/dashboard";

                }).catch(function(error){
                    app.showNotification("top","right","danger",error.response.data.message);
                });
            },

            post_anomaly:function(){

                var values=this.anomalies[this.anomalies.length-1];
                var csrftoken = Cookies.get('csrftoken');
                function csrfSafeMethod(method) {
                    // these HTTP methods do not require CSRF protection
                    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                }

                $.ajaxSetup({
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                });

                axios.interceptors.request.use(config => {
                    // log a message before any HTTP request is sent
                    console.log('Request was sent');
                    addspinner();
                    return config;
                });

                function addspinner(){
                    $(".overlay").addClass("d-block");
                    $(".overlay").removeClass("d-none");
                    $(".loader").removeClass("d-none");
                    $(".loader").addClass("d-block",400);

                    $('.customer_select').val(null).trigger('change');

                }
                function removespinner(){
                    $(".overlay").addClass("d-none");
                    $(".overlay").removeClass("d-block");
                    $(".loader").removeClass("d-block",400);
                    $(".loader").addClass("d-none",400);
                }
                axios.interceptors.response.use(function (response) {
                    // Any status code that lie within the range of 2xx cause this function to trigger
                    // Do something with response data
                    removespinner();
                    return response;
                }, function (error) {
                    // Any status codes that falls outside the range of 2xx cause this function to trigger
                    // Do something with response error
                    removespinner();
                    return Promise.reject(error);
                });
                axios.defaults.xsrfCookieName = csrftoken;
                axios.defaults.xsrfHeaderNamefalse = "X-CSRFToken";
                let formData = new FormData();
                formData.append('anomaly_description',values['anomaly_description']);
                formData.append('anomaly_comment',values['anomaly_comment']);
                formData.append('anomaly_criticality', values['anomaly_criticality']);
                formData.append('reportid', app.reportid);
                formData.append('entity','anomalies');

                axios.post( '/reports/post/entity/',
                    formData,
                    {
                        headers: {
                            'Content-Type': 'multipart/form-data',
                            'X-CSRFToken':csrftoken
                        }
                    }
                ).then(function(data1){
                    console.log('SUCCESS!!');
                    app.showNotification("top","right","success",data1.data.message);
                    app.update_table();
                    // window.location.href = "/dashboard";

                }).catch(function(error){
                    app.showNotification("top","right","danger",error.response.data.message);
                });


            },
            update_table:function(){
                var data123=[];
                var anomalyurl='/reports/get/anomalies/'+this.reportid;
                axios.get(anomalyurl)
                    .then(function (response) {
                        app.anomalies=response.data.anomalies.values;
                    }).catch(function(error){
                    console.log("Error");
                });
                var commenturl='/reports/get/comments/'+this.reportid;
                axios.get(commenturl)
                    .then(function (response) {
                        // handle success
                        console.log(app.comments)
                        app.comments=response.data.comments.values;
                    })
                    .catch(function (error) {
                        // handle error
                        console.log("error");
                    });
                var checklisturl='/reports/get/checklists/'+this.reportid;
                axios.get(checklisturl)
                    .then(function (response) {
                        // handle success
                        console.log("Checklist API")
                        console.log(response.data.checklists);
                        app.checklists=response.data.checklists;
                        app.checklist_loaded=true;
                    })
                    .catch(function (error) {
                        // handle error
                        console.log("error checklists");
                    });
                var reporturl='/reports/get/report/'+this.reportid;
                axios.get(reporturl)
                    .then(function (response) {
                        console.log(response)
                        app.report=response.data.report;

                    }).catch(function(error){
                    console.log("Error");
                });

                var activitiesurl='/reports/get/activities/'+this.reportid;
                axios.get(activitiesurl)
                    .then(function (response) {
                        console.log(response.data.activity)
                        app.activities=response.data.activity;
                    }).catch(function(error){
                    console.log("Error");
                });
            },
            submitreport:function(e){

                var csrftoken = Cookies.get('csrftoken');
                function csrfSafeMethod(method) {
                    // these HTTP methods do not require CSRF protection
                    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                }

                $.ajaxSetup({
                    beforeSend: function(xhr, settings) {
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                });

                axios.interceptors.request.use(config => {
                    // log a message before any HTTP request is sent
                    console.log('Request was sent');
                    addspinner();
                    return config;
                });

                function addspinner(){
                    $(".overlay").addClass("d-block");
                    $(".overlay").removeClass("d-none");
                    $(".loader").removeClass("d-none");
                    $(".loader").addClass("d-block",400);

                    $('.customer_select').val(null).trigger('change');

                }
                function removespinner(){
                    $(".overlay").addClass("d-none");
                    $(".overlay").removeClass("d-block");
                    $(".loader").removeClass("d-block",400);
                    $(".loader").addClass("d-none",400);
                }
                axios.interceptors.response.use(function (response) {
                    // Any status code that lie within the range of 2xx cause this function to trigger
                    // Do something with response data
                    removespinner();
                    return response;
                }, function (error) {
                    // Any status codes that falls outside the range of 2xx cause this function to trigger
                    // Do something with response error
                    removespinner();
                    return Promise.reject(error);
                });
                axios.defaults.xsrfCookieName = csrftoken;
                axios.defaults.xsrfHeaderName = "X-CSRFToken";
                let formData = new FormData();

                formData.append('reportid', app.reportid);
                formData.append('reportstatus',e.target.value);

                axios.post( '/reports/update/report/',
                    formData,
                    {
                        headers: {
                            'Content-Type': 'multipart/form-data',
                            'X-CSRFToken':csrftoken
                        }
                    }
                ).then(function(data1){
                    console.log('update SUCCESS!!');
                    app.showNotification("top","right","success",data1.data.message);
                     //window.location.href = "/dashboard";
                     location.reload();

                }).catch(function(error){
                console.log('update error!!');
                    app.showNotification("top","right","danger",error.response.data.message);
                });
            },
            set_report_month:function(){

                // this.report_month =this.report.month;
                // this.report_month  = ("0" + this.report_month).slice(-2);
                // this.report_year=this.report.year;
                // this.report_date=String(this.report_year)+"-"+String(this.report_month)+"-01";
                console.log("Date is ");
                console.log(this.report_date);
                this.m0 = moment(this.report_date).format('MMMM YYYY');
                console.log()
                this.m1 = moment(this.report_date).subtract(3, 'months').format('MMMM YYYY');
                this.m2 = moment(this.report_date).subtract(2, 'months').format('MMMM YYYY');
                this.m3 = moment(this.report_date).subtract(1, 'months').format('MMMM YYYY');


            },
        },
        mounted: function(){
            console.log("mounted");

            $('#init_query_date').datepicker({
                format: "yyyy-mm-dd",
                autoclose: true
            }).on('changeDate',function(e){
                app.init_query_date=$('#init_query_date').val();
            });

            $('#final_query_date').datepicker({
                format: "yyyy-mm-dd",
                autoclose: true
            }).on('changeDate',function(e){
                app.final_query_date=$('#final_query_date').val();
            });

            $("#fcdashboard").addClass("active");
            $("#fcdashboard").addClass("show");


            var data123=[];
            var anomalyurl='/reports/get/anomalies/'+this.reportid;
            axios.get(anomalyurl)
                .then(function (response) {
                    app.anomalies=response.data.anomalies.values;
                }).catch(function(error){
                console.log("Error");
            });
            var commenturl='/reports/get/comments/'+this.reportid;
            axios.get(commenturl)
                .then(function (response) {
                    // handle success

                    app.comments=response.data.comments.values;
                    console.log("Comment are ",app.comments);
                })
                .catch(function (error) {
                    // handle error
                    console.log("error");
                });
            var checklisturl='/reports/get/checklists/'+this.reportid;
            axios.get(checklisturl)
                .then(function (response) {
                    // handle success
                    console.log(response.data.checklists.acc_checklist);
                    app.checklists=response.data.checklists;
                    app.checklist_loaded=true;
                })
                .catch(function (error) {
                    // handle error
                    console.log("error");
                });

            var reporturl='/reports/get/report/'+this.reportid;
            axios.get(reporturl)
                .then(function (response) {
                    console.log(response)
                    app.report=response.data.report;
                    app.set_report_month();
                }).catch(function(error){
                console.log("Error");
            });

            var activitiesurl='/reports/get/activities/'+this.reportid;
            axios.get(activitiesurl)
                .then(function (response) {
                    console.log(response.data.activity)
                    app.activities=response.data.activity;
                }).catch(function(error){
                console.log("Error");
            });
            this.is_connected();

            $('#datepicker').datepicker({
                format: "yyyy-mm",
                startView: "months",
                minViewMode: "months",
                autoclose: true
            }).on('changeDate',function(e){
                app.report_date=$('#datepicker').val()+'-01';
                app.m0 = moment(app.report_date).format('MMMM YYYY');
                app.m1 = moment(app.report_date).subtract(3, 'months').format('MMMM YYYY');
                app.m2 = moment(app.report_date).subtract(2, 'months').format('MMMM YYYY');
                app.m3 = moment(app.report_date).subtract(1, 'months').format('MMMM YYYY');
                console.log(app.report_date);
            });
            this.checkReportOwner();
        },
        updated: function(){


        },
        filters: {
            entityName:  function (x) {
                if (!x) return ''
                x=x.replaceAll("'","\"")
                res=JSON.parse(x).name
                return res;
            }
        }

    });


</script>
<!--<script>-->
<!--    if (window.opener) {-->
<!--        window.opener.location.href = '/quickbooks_api/'-->
<!--        window.close()-->
<!--    }-->
<!--</script>-->

<script>
    function launchPopup(path) {
        var win;
        var checkConnect;
        var parameters = "location=1,width=800,height=650";
        parameters += ",left=" + (screen.width - 800) / 2 + ",top=" + (screen.height - 650) / 2;

        // Launch Popup
        win = window.open(path, 'connectPopup', parameters);
    }
</script>

<script>
    console.log(app.reportid);
    var pdfurl="/reports/get/file/"+app.reportid+'/0/pdf';
    PDFObject.embed(pdfurl, "#pdfviewer");
</script>

<script>
    function apiCall() {
        $('#result').removeClass('d-none');
        $("#result").html('Loading...');

        var url="/quickbooks_api/apiCall/"+String(app.reportid)+"/"+String(app.init_query_date)+"/"+String(app.final_query_date);
        console.log(url);
        $.get(url, function (data) {
            console.log(data);
            var obj = JSON.parse(data);
            $("#jsonresult").html( JSON.stringify(obj, null, 2));
            $('#result').addClass('d-none');

        })
    }

    function revokeCall() {
        $("#result").html('Loading...')
        $.get("/quickbooks_api/disconnect", function (data) {
            $("#result").html(data)
        })
    }

    function refreshCall() {
        $("#result").html('Loading...')
        $.get("/quickbooks_api/refreshTokenCall", function (data) {
            $("#result").html(JSON.stringify(data, null, 2))
        })
    }

</script>

</body>
</html>
