
{% include "head.html" %}
{% load static %}
{% load home_extras %}
<body>


    {% include "sidebarlinks.html" %}
        <div class="main-content" id="panel">
      <!-- Navbar -->
      {% include "navbar.html" %}
            <div class="header bg-primary pb-6">
                <div class="container-fluid">
                    <div class="header-body">
                        <div class="row align-items-center py-4">
                            <div class="col-lg-6 col-7">
<!--                                <h6 class="h2 text-white d-inline-block mb-0">Default</h6>-->
                                <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
                                    <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                                        <li class="breadcrumb-item"><a href="#"><i class="fas fa-home"></i></a></li>
                                        <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
<!--                                        <li class="breadcrumb-item active" aria-current="page">Default</li>-->
                                    </ol>
                                </nav>
                            </div>
<!--                            <div class="col-lg-6 col-5 text-right">-->
<!--                                <a href="#" class="btn btn-sm btn-neutral">New</a>-->
<!--                                <a href="#" class="btn btn-sm btn-neutral">Filters</a>-->
<!--                            </div>-->
                        </div>
                        <!-- Card stats -->
                        <div class="row">
                            <div class="col-xl-4 col-md-4">
                                <div class="card card-stats">
                                    <!-- Card body -->
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col">
                                                <h5 class="card-title text-uppercase text-muted mb-0">Tasks Pending</h5>
                                                <span class="h2 font-weight-bold mb-0" v-if="havetasks">[[ mypendingtasks.length]]</span>
                                                <span class="h2 font-weight-bold mb-0" v-if="!havetasks">0</span>
                                            </div>
                                            <div class="col-auto">
                                                <div class="icon icon-shape bg-gradient-blue text-white rounded-circle shadow">
                                                    <i class="ni ni-active-40"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="mt-3 mb-0 text-sm">
<!--                                            <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> 3.48%</span>-->
<!--                                            <span class="text-nowrap">Since last month</span>-->
                                            <a href="/tasks/overview?stage=pending" class="btn btn-primary btn-sm"> See all</a>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-4 col-md-4" v-if="!useriscrm">
                                <div class="card card-stats">
                                    <!-- Card body -->
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col">
                                                <h5 class="card-title text-uppercase text-muted mb-0">Sent for Approval </h5>
                                                <span class="h2 font-weight-bold mb-0" v-if="havetasks">[[ myawaitingapprovaltasks.length]]</span>
                                                <span class="h2 font-weight-bold mb-0" v-if="!havetasks">0</span>
                                            </div>
                                            <div class="col-auto">
                                                <div class="icon icon-shape bg-gradient-orange text-white rounded-circle shadow">
                                                    <i class="ni ni-chart-bar-32"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="mt-3 mb-0 text-sm">
                                            <!--                                            <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> 3.48%</span>-->
                                            <!--                                            <span class="text-nowrap">Since last month</span>-->
                                            <a href="/tasks/overview?stage=sentforapproval" class="btn btn-warning btn-sm"> See all</a>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-4 col-md-4">
                                <div class="card card-stats">
                                    <!-- Card body -->
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col">
                                                <h5 class="card-title text-uppercase text-muted mb-0">Total Tasks Completed</h5>
                                                <span class="h2 font-weight-bold mb-0" v-if="havetasks">[[ mycompletedtasks.length]]</span>
                                                <span class="h2 font-weight-bold mb-0" v-if="!havetasks">0</span>
                                            </div>
                                            <div class="col-auto">
                                                <div class="icon icon-shape bg-gradient-green text-white rounded-circle shadow">
                                                    <i class="ni ni-chart-pie-35"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="mt-3 mb-0 text-sm">
                                            <!--                                            <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> 3.48%</span>-->
                                            <!--                                            <span class="text-nowrap">Since last month</span>-->
                                            <a href="/tasks/overview?stage=completed" class="btn btn-success btn-sm"> See all</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-md-6 d-none">
                                <div class="card card-stats">
                                    <!-- Card body -->
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col">
                                                <h5 class="card-title text-uppercase text-muted mb-0">Pending Reviews From You</h5>
                                                <span class="h2 font-weight-bold mb-0">924</span>
                                            </div>
                                            <div class="col-auto">
                                                <div class="icon icon-shape bg-gradient-orange text-white rounded-circle shadow">
                                                    <i class="ni ni-money-coins"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="mt-3 mb-0 text-sm">
                                            <!--                                            <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> 3.48%</span>-->
                                            <!--                                            <span class="text-nowrap">Since last month</span>-->
                                            <a href="/tasks/overview" class="btn btn-warning btn-sm"> See all</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-header border-0">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h3 class="mb-0">Tasks Pending</h3>
                                    </div>
                                    <div class="col text-right">
                                        <a href="/tasks/overview?stage=pending" class="btn btn-sm btn-primary">See all</a>
                                    </div>
                                </div>
                            </div>
                            <div v-if="havetasks" class="table-responsive">
                                <!-- Projects table -->
                                <table class="table align-items-center table-flush">
                                    <thead class="thead-light">
                                    <tr>
                                        <th scope="col">Customer Name</th>
                                        <th scope="col">Month-Year</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">Report Type</th>
                                        <th scope="col">Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr v-for="pt in mypendingtasks.slice(0,5)">
                                        <th scope="row">
                                            [[ pt.customer ]]
                                        </th>
                                        <td>
                                            [[ pt.month ]]-[[ pt.year ]]
                                        </td>
                                        <td>
                                            [[ pt.status ]]
                                        </td>
                                        <td>
                                            [[ pt.report_type ]]
                                        </td>
                                        <td>

                                                <a class="btn btn-sm btn-success" :href="'/tasks/view/'+(pt.id)" target="_blank"><span><i class="bold-right"></i> Go </span></a>


                                        </td>
                                    </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 d-none">
                        <div class="card">
                            <div class="card-header border-0">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h3 class="mb-0">Peer Reviews Pending</h3>
                                    </div>
                                    <div class="col text-right">
                                        <a href="/tasks/overview/" class="btn btn-sm btn-primary">See all</a>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <!-- Projects table -->
                                <table class="table align-items-center table-flush">
                                    <thead class="thead-light">
                                    <tr>
                                        <th scope="col">Accountant</th>
                                        <th scope="col">Customer</th>
                                        <th scope="col">Date</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <th scope="row">
                                            Facebook
                                        </th>
                                        <td>
                                            1,480
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span class="mr-2">60%</span>
                                                <div>
                                                    <div class="progress">
                                                        <div class="progress-bar bg-gradient-danger" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">
                                            Facebook
                                        </th>
                                        <td>
                                            5,480
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span class="mr-2">70%</span>
                                                <div>
                                                    <div class="progress">
                                                        <div class="progress-bar bg-gradient-success" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">
                                            Google
                                        </th>
                                        <td>
                                            4,807
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span class="mr-2">80%</span>
                                                <div>
                                                    <div class="progress">
                                                        <div class="progress-bar bg-gradient-primary" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">
                                            Instagram
                                        </th>
                                        <td>
                                            3,678
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span class="mr-2">75%</span>
                                                <div>
                                                    <div class="progress">
                                                        <div class="progress-bar bg-gradient-info" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">
                                            twitter
                                        </th>
                                        <td>
                                            2,645
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span class="mr-2">30%</span>
                                                <div>
                                                    <div class="progress">
                                                        <div class="progress-bar bg-gradient-warning" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" style="width: 30%;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4">
                        <div class="card">
                            <!-- Card header -->
                            <div class="card-header">
                                <!-- Title -->
                                <h5 class="h3 mb-0">Latest Comments & Anomalies</h5>
                            </div>
                            <!-- Card body -->
                            <div class="card-body">
                                <div class="timeline timeline-one-side" data-timeline-content="axis" data-timeline-axis-style="dashed">
                                    <div class="timeline-block">
                                      <span class="timeline-step badge-success">
                                        <i class="ni ni-chat-round"></i>
                                      </span>
                                        <div class="timeline-content">
                                            <div class="d-flex justify-content-between pt-1">
                                                <div>
                                                    <span class="text-muted text-sm font-weight-bold">Comment</span>
                                                </div>
                                                <div class="text-right">
                                                    <small class="text-muted"><i class="fas fa-clock mr-1"></i>2 hrs ago</small>
                                                </div>
                                            </div>
                                            <h6 class="text-sm mt-1 mb-0">Let's meet at Starbucks at 11:30. Wdyt?</h6>
                                        </div>
                                    </div>
                                    <div class="timeline-block">
                                      <span class="timeline-step badge-danger">
                                        <i class="ni ni-notification-70"></i>
                                      </span>
                                        <div class="timeline-content">
                                            <div class="d-flex justify-content-between pt-1">
                                                <div>
                                                    <span class="text-muted text-sm font-weight-bold">Anomaly</span>
                                                </div>
                                                <div class="text-right">
                                                    <small class="text-muted"><i class="fas fa-clock mr-1"></i>3 hrs ago</small>
                                                </div>
                                            </div>
                                            <h6 class="text-sm mt-1 mb-0">A new issue has been reported for Argon.</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <!-- Card header -->
                            <div class="card-header">
                                <!-- Title -->
                                <h5 class="h3 mb-0">My Customers</h5>
                            </div>
                            <!-- Card body -->
                            <div class="card-body">
                                <!-- List group -->
                                <ul class="list-group list-group-flush list my--3">
                                    <li class="list-group-item px-0" v-for="cust in mycustomers">
                                        <div class="row align-items-center">
                                            <div class="col-auto">
                                                <!-- Avatar -->
                                                <a href="#" class="avatar rounded-circle">
                                                    <img alt="Image placeholder" src="{% static 'argon/assets/img/default-avatar.png' %}">
                                                </a>
                                            </div>
                                            <div class="col ml--2">
                                                <h4 class="mb-0">
                                                    <a href="#!">[[ cust.name ]]</a>
                                                </h4>
                                                <span class="text-success">●</span>
                                                <small>Initiated</small>
                                            </div>
                                            <div class="col-auto">
                                                <button type="button" class="btn btn-sm btn-primary">View</button>
                                            </div>
                                        </div>
                                    </li>

                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <!-- Calendar widget -->
                        <!--* Card header *-->
                        <!--* Card body *-->
                        <!--* Card init *-->
                        <div class="card widget-calendar">
                            <!-- Card header -->
                            <div class="card-header">
                                <div class="h5 text-muted mb-1 widget-calendar-year"></div>
                                <div class="h3 mb-0 widget-calendar-day"></div>
                            </div>
                            <!-- Card body -->
                            <div class="card-body">
                                <div data-toggle="widget-calendar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <footer class="footer pt-0">
                    <div class="row align-items-center justify-content-lg-between">
                        <div class="col-lg-6">
                            <div class="copyright text-center text-lg-left text-muted">
                                &copy; 2019 <a href="https://www.firstcourse.in" class="font-weight-bold ml-1" target="_blank">FirstCourse</a>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                                <li class="nav-item">
                                    <a href="https://www.firstcourse.in" class="nav-link" target="_blank">FirstCourse</a>
                                </li>
                                <li class="nav-item">
                                    <a href="https://www.firstcourse.in/aboutus" class="nav-link" target="_blank">About Us</a>
                                </li>
<!--                                <li class="nav-item">-->
<!--                                    <a href="http://blog.creative-tim.com" class="nav-link" target="_blank">Blog</a>-->
<!--                                </li>-->
<!--                                <li class="nav-item">-->
<!--                                    <a href="https://www.creative-tim.com/license" class="nav-link" target="_blank">License</a>-->
<!--                                </li>-->
                            </ul>
                        </div>
                    </div>
                </footer>
            </div>


    </div>


  {% include 'footer.html' %}
    <script src="{% static 'argon/assets/vendor/moment/min/moment.min.js' %}"></script>
    <script src="{% static 'argon/assets/vendor/fullcalendar/dist/fullcalendar.min.js' %}"></script>

  <script src="{% static 'js/insights.js' %}"></script>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/js/select2.min.js"></script>
  <script src ="https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.1/qs.min.js"></script>
  <script type="text/javascript">
        var mydashboard = new Vue({
            delimiters: ['[[', ']]'],
            el: '#panel',
            data: {
                mytasks:[],
                mycomments:[],
                myanomalies:[],
                myevents:[],
                // mypendingtasks:[],
                mypendingreviews:[],
                mycustomers:[],
                myinfo:[],
                userisaccountant:false,
                useristl:false,
                userisqc:false,
                useriscrm:false,
                useriscustomer:false,
                havetasks:false,
            },
            methods: {
                gettasks: function(){
                    axios.get('/reports/get/tasks/all')
                        .then(function (response) {
                            if(response.data.tasks!=null && response.data.tasks!='' && response.data.tasks.length!=0 && (typeof response.data.tasks !== "undefined") ){
                                mydashboard.mytasks=response.data.tasks;
                                mydashboard.havetasks=true;
                            }


                        }).catch(function(error){
                        console.log("Error");
                    }).finally(function(){
                        mydashboard.getcustomers();
                    });
                },
                getcustomers: function(){
                    axios.get('/customers/get/all')
                        .then(function (response) {
                            console.log(response.data);
                            mydashboard.mycustomers=response.data;

                        }).catch(function(error){
                        console.log("Error");
                    }).finally(function(){
                        mydashboard.getmyinfo();
                    });
                },
                getmyinfo: function(){
                    axios.get('/employees/get/myinfo')
                        .then(function (response) {
                            console.log(response.data);
                            mydashboard.myinfo=response.data;

                        }).catch(function(error){
                        console.log("Error");
                    }).finally(function(){
                        mydashboard.setusergroup();
                    });
                },
                setusergroup: function(){
                    var groups = this.myinfo.groups;



                    for(var i=0;i<groups.length;i++)
                    {
                        if(groups[i].name == "Accountant"){
                            this.userisaccountant=true;
                        }

                        if(groups[i].name == "TeamLead"){
                            this.useristl=true;
                        }

                        if(groups[i].name == "QC"){
                            this.userisqc=true;
                        }

                        if(groups[i].name == "CRM"){
                            this.useriscrm=true;
                        }
                    }
                }
            },
            updated: function(){

            },
            mounted: function(){
                this.gettasks();

            },
            computed: {
                mypendingtasks: function(){
                    var pendingtasks=[];
                    if(this.userisaccountant){

                        for(var i=0;i<this.mytasks.length;i++){
                            if(this.mytasks[i].status == "Initiated" || this.mytasks[i].status == "Review" ){
                                pendingtasks.push(this.mytasks[i]);
                            }
                        }
                        return pendingtasks;
                    }

                    if(this.useristl){
                        for(var i=0;i<this.mytasks.length;i++){
                            if(this.mytasks[i].status == "TL"){
                                pendingtasks.push(this.mytasks[i]);
                            }
                        }
                        return pendingtasks;
                    }

                    if(this.userisqc){
                        for(var i=0;i<this.mytasks.length;i++){
                            if(this.mytasks[i].status == "QC"){
                                pendingtasks.push(this.mytasks[i]);
                            }
                        }
                        return pendingtasks;
                    }

                    if(this.useriscrm){
                        for(var i=0;i<this.mytasks.length;i++){
                            if(this.mytasks[i].status == "CRM"){
                                pendingtasks.push(this.mytasks[i]);
                            }
                        }
                        return pendingtasks;
                    }
                },
                myawaitingapprovaltasks: function(){
                    var awaitingapprovaltasks=[];
                    if(this.userisaccountant){
                        console.log("mytasks");
                        console.log(this.mytasks);
                        for(var i=0;i<this.mytasks.length;i++){
                            if(this.mytasks[i].status == "TL" ||  this.mytasks[i].status == "QC" || this.mytasks[i].status == "CRM"){
                                awaitingapprovaltasks.push(this.mytasks[i]);
                            }
                        }
                        return awaitingapprovaltasks;
                    }

                    if(this.useristl){
                        for(var i=0;i<this.mytasks.length;i++){
                            if(this.mytasks[i].status == "QC" || this.mytasks[i].status == "CRM"){
                                awaitingapprovaltasks.push(this.mytasks[i]);
                            }
                        }
                        return awaitingapprovaltasks;
                    }

                    if(this.userisqc){
                        for(var i=0;i<this.mytasks.length;i++){
                            if(this.mytasks[i].status == "CRM"){
                                awaitingapprovaltasks.push(this.mytasks[i]);
                            }
                        }
                        return awaitingapprovaltasks;
                    }

                    if(this.useriscrm){

                        return awaitingapprovaltasks;
                    }
                },
                mycompletedtasks: function(){
                    var completedtasks=[];
                    if(!this.useriscustomer){
                        console.log(this.mytasks);
                        for(var i=0;i<this.mytasks.length;i++){
                            if(this.mytasks[i].status == "Published"  ){
                                completedtasks.push(this.mytasks[i]);
                            }
                        }
                        return completedtasks;
                    }
                },
            },
            filters: {

            }

        });
  </script>
</body>



</html>